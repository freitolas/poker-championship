<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Texas Hold'em Championship Manager</title>
  <style>
    body {
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #fff7e1 0%, #ffe0b2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #7a4800;
      display: flex;
      flex-direction: row;
      height: 100vh;
      min-height: 100vh;
    }
    .main-content {
      flex: 3;
      padding: 20px 16px 20px 40px;
      box-sizing: border-box;
      min-width: 500px;
    }
    h1 {
      text-align: center;
      color: #e65100;
      margin-bottom: 12px;
      font-family: 'Arial Black', Arial, sans-serif;
      letter-spacing: 0.04em;
      font-size: 2rem;
      text-shadow: 2px 2px 8px #fff6e0, 1px 1px 0px #ffcc80;
    }
    .game-info {
      background: linear-gradient(90deg, #ffd740 0%, #ffa726 100%);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 20px;
      text-align: center;
      color: #d84315;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(255,152,0,0.2);
    }
    .player-setup {
      background: #fff3e0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
      border: 2px solid #ffa726;
    }
    .player-input-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
    }
    #playerNameInput {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ffa726;
      border-radius: 5px;
      font-size: 1rem;
    }
    .setup-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto 19px auto;
      background: #fff3e0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(255,152,0,0.15);
      font-size: 0.95rem;
    }
    th, td {
      border: none;
      padding: 8px 12px;
      text-align: center;
      font-weight: 600;
    }
    thead {
      background: linear-gradient(90deg, #ff9800 0%, #fb8c00 100%);
      color: white;
      font-size: 1rem;
      letter-spacing: 0.05em;
    }
    tbody tr:nth-child(odd) {
      background: #fff9e5;
    }
    tbody tr.eliminated {
      background: #ffcdd2 !important;
      color: #c62828;
      opacity: 0.8;
    }
    button, select {
      margin: 2px 4px;
      padding: 8px 12px;
      border-radius: 5px;
      border: 1px solid #ffa726;
      font-size: 0.95rem;
      cursor: pointer;
      background: #ffb74d;
      color: #7a4800;
      font-weight: 700;
      transition: all 0.3s ease;
    }
    button:hover {
      background: #ff9800;
      color: #fffde7;
    }
    button:disabled {
      background: #e0e0e0;
      color: #9e9e9e;
      cursor: not-allowed;
    }
    .action-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-top: 20px;
    }
    .timer-panel {
      flex: 1;
      min-width: 400px;
      max-width: 600px;
      background: linear-gradient(135deg,#ffecb3 0%, #ffd54f 100%);
      border-left: 7px solid #ffa726;
      box-shadow: -2px 0 14px #ffa72622;
      padding: 25px 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      position: sticky;
      right: 0;
      top: 0;
      box-sizing: border-box;
    }
    .timer-header {
      font-size: 2.2rem;
      font-weight: 900;
      color: #e65100;
      text-shadow: 2px 2px #fffcc6, 1px 1px 0 #ffedb0;
      margin-bottom: 20px;
      letter-spacing: 0.04em;
    }
    .round-info {
      width: 100%;
      background: #ffe0b2;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(255,152,0,0.1);
      padding: 20px;
      font-size: 1.6rem;
      font-weight: 700;
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 30px;
      align-items: center;
      text-align: center;
      color: #e65100;
    }
    .blind-display {
      background: #ffd54f;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 1.8rem;
      margin: 5px 0;
      color: #e65100;
    }
    .time-remaining {
      font-size: 3.5rem;
      font-weight: 900;
      background: #ffd54f;
      color: #e65100;
      border-radius: 15px;
      padding: 15px 30px;
      margin: 15px 0 25px 0;
      box-shadow: 0 2px 8px rgba(255,152,0,0.2);
      text-align: center;
      letter-spacing: 0.08em;
    }
    .timer-controls {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    .timer-controls button {
      font-size: 1.1rem;
      font-weight: 900;
      border-radius: 8px;
      padding: 12px 20px;
      background: #ffb74d;
      color: #7a4800;
      border: none;
      min-width: 100px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .timer-controls button:hover:not(:disabled) {
      background: #ff9800;
      color: #fffde7;
    }
    .break-notice {
      background: #bbdefb;
      color: #0d47a1;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: 700;
      margin: 10px 0;
      display: none;
    }
    .final-stage {
      background: #ffecb3;
      color: #e65100;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: 700;
      margin: 10px 0;
      display: none;
    }
    .prize-info {
      margin-top: 20px;
      padding: 15px;
      background: #fff3e0;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
      color: #e65100;
    }
    .flash {
      animation: flash 1s linear 0s 3 alternate;
    }
    @keyframes flash {
      0% { background: #ffd54f; }
      100% { background: #ff5722; color: white; }
    }
  </style>
</head>
<body>
  <div class="main-content">
    <h1>Texas Hold'em Championship Manager</h1>
    
    <div class="game-info">
      <div>Buy-in: ¬£5 per stack | 1st: 80% | 2nd: 20% | House Fee: ¬£5 (¬£10 if pot > ¬£100)</div>
    </div>

    <div class="player-setup">
      <h3>Add Players</h3>
      <div class="player-input-row">
        <input type="text" id="playerNameInput" placeholder="Enter player name..." />
        <button onclick="addPlayer()">Add Player</button>
      </div>
      <div class="setup-buttons">
        <button onclick="startTournament()" id="startBtn">Start Tournament</button>
        <button onclick="clearPlayers()">Clear All Players</button>
      </div>
      <div id="playerCount">Players: 0 | Prize Pot: ¬£0 | House Fee: ¬£0</div>
    </div>

    <table id="playerTable">
      <thead>
        <tr>
          <th>Player</th>
          <th>Stacks</th>
          <th>Total Paid</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="playerTableBody">
        <!-- Players will be added here -->
      </tbody>
    </table>

    <div class="action-buttons">
      <button onclick="processRebuys()" id="rebuyBtn" disabled>Process Re-buys</button>
      <button onclick="processAddons()" id="addonBtn" disabled>Process Add-ons (Break Only)</button>
      <button onclick="calculatePrizes()" id="prizeBtn" disabled>Calculate Final Prizes</button>
    </div>

    <div id="prizeResults"></div>
  </div>

  <div class="timer-panel">
    <div class="timer-header">ROUND TIMER</div>
    <div id="roundInfo" class="round-info">
      <div>Round 1</div>
      <div class="blind-display">SB: 5 | BB: 10</div>
      <div style="font-size: 1.2rem;">Duration: 20 minutes</div>
    </div>
    <div id="timeRemaining" class="time-remaining">20:00</div>
    <div class="timer-controls">
      <button id="timerStartBtn" onclick="startTimer()">START</button>
      <button id="timerPauseBtn" onclick="pauseTimer()" disabled>PAUSE</button>
      <button id="timerResetBtn" onclick="resetTimer()">RESET</button>
      <button id="timerSkipBtn" onclick="skipRound()">SKIP ROUND</button>
    </div>
    
    <div id="breakNotice" class="break-notice">
      <strong>BREAK TIME!</strong><br>
      30 minutes - Add-ons available
    </div>
    
    <div id="finalStage" class="final-stage">
      <strong>FINAL STAGE</strong><br>
      No more re-buys or add-ons
    </div>

    <div class="prize-info">
      <div><strong>Current Prize Pool: ¬£<span id="currentPrizePool">0</span></strong></div>
      <div>1st Place: ¬£<span id="firstPrize">0</span></div>
      <div>2nd Place: ¬£<span id="secondPrize">0</span></div>
    </div>

    <audio id="roundAlarm">
      <source src="alarm.mp3" type="audio/mp3">
    </audio>
  </div>

  <script>
    // Round structure based on your timetable
const rounds = [
  { name: "Test Round", sb: 0, bb: 0, duration: 0.1 },      // ~5 seconds
  { name: "Round 1",     sb: 5,  bb: 10, duration: 20 },
  { name: "Round 2",     sb: 10, bb: 20, duration: 20 },
  { name: "Round 3",     sb: 20, bb: 40, duration: 20 },
  { name: "Round 4",     sb: 40, bb: 80, duration: 20 },
  { name: "Break + Add-On", sb: 0, bb: 0, duration: 30, isBreak: true },
  { name: "Round 5",     sb: 50, bb: 100, duration: 20 },
  { name: "Round 6",     sb: 100,bb: 200, duration: 20 },
  { name: "Round 7",     sb: 200,bb: 400, duration: 20 },
  { name: "Round 8",     sb: 400,bb: 800, duration: 20 },
  { name: "Round 9",     sb: 1000,bb:2000, duration: 20 }
];


    let players = [];
    let currentRound = 0;
    let timer = null;
    let timeLeft = 20 * 60; // 20 minutes in seconds
    let isRunning = false;
    let isPaused = false;
    let tournamentStarted = false;
    let isBreak = false;
    let isFinalStage = false;

    function addPlayer() {
      const nameInput = document.getElementById('playerNameInput');
      const name = nameInput.value.trim();
      
      if (name === '') {
        alert('Please enter a player name');
        return;
      }
      
      if (players.find(p => p.name === name)) {
        alert('Player already exists');
        return;
      }

      players.push({
        name: name,
        stacks: 1,
        totalPaid: 5,
        eliminated: false,
        canRebuy: true
      });

      nameInput.value = '';
      nameInput.focus();
      updatePlayerTable();
      updatePrizeInfo();
    }

    // Allow Enter key to add player
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('playerNameInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addPlayer();
        }
      });
    });

    function clearPlayers() {
      players = [];
      updatePlayerTable();
      updatePrizeInfo();
    }

    function removePlayer(index) {
      players.splice(index, 1);
      updatePlayerTable();
      updatePrizeInfo();
    }

    function eliminatePlayer(index) {
      players[index].eliminated = true;
      // Don't disable rebuy here - let the stage logic handle it
      updatePlayerTable();
    }

    function rebuyPlayer(index) {
      if (!players[index].canRebuy || isFinalStage) {
        alert('Re-buys not available in final stage');
        return;
      }
      
      if (!players[index].eliminated) {
        alert('Player must be eliminated to re-buy');
        return;
      }
      
      players[index].stacks += 1;
      players[index].totalPaid += 5;
      players[index].eliminated = false;
      updatePlayerTable();
      updatePrizeInfo();
    }

    function addonPlayer(index) {
      if (!isBreak) {
        alert('Add-ons only available during break');
        return;
      }
      
      players[index].stacks += 1;
      players[index].totalPaid += 5;
      updatePlayerTable();
      updatePrizeInfo();
    }

    function updatePlayerTable() {
      const tbody = document.getElementById('playerTableBody');
      tbody.innerHTML = '';
      
      players.forEach((player, index) => {
        const tr = document.createElement('tr');
        if (player.eliminated) tr.classList.add('eliminated');
        
        let actionsHtml = '';
        
        // Before tournament starts
        if (!tournamentStarted) {
          actionsHtml = `<button onclick="removePlayer(${index})">Remove</button>`;
        } 
        // During tournament
        else {
          // Eliminate button for active players
          if (!player.eliminated) {
            actionsHtml += `<button onclick="eliminatePlayer(${index})">Eliminate</button>`;
          }
          
          // Re-buy button for eliminated players (before final stage)
          if (player.eliminated && player.canRebuy && !isFinalStage) {
            actionsHtml += `<button onclick="rebuyPlayer(${index})" style="background: #ff5722; color: white;">Re-buy ¬£5</button>`;
          }
          
          // Add-on button during break
          if (isBreak) {
            actionsHtml += `<button onclick="addonPlayer(${index})" style="background: #2196f3; color: white;">Add-on ¬£5</button>`;
          }
        }
        
        tr.innerHTML = `
          <td>${player.name}</td>
          <td>${player.stacks}</td>
          <td>¬£${player.totalPaid}</td>
          <td>${player.eliminated ? 'Eliminated' : 'Active'}</td>
          <td>${actionsHtml}</td>
        `;
        tbody.appendChild(tr);
      });

      // Update player count
      const totalPlayers = players.length;
      const totalPaid = players.reduce((sum, p) => sum + p.totalPaid, 0);
      const houseFee = totalPaid > 100 ? 10 : 5;
      const prizePool = totalPaid - houseFee;
      
      document.getElementById('playerCount').textContent = 
        `Players: ${totalPlayers} | Prize Pot: ¬£${prizePool} | House Fee: ¬£${houseFee}`;
    }

    function updatePrizeInfo() {
      const totalPaid = players.reduce((sum, p) => sum + p.totalPaid, 0);
      const houseFee = totalPaid > 100 ? 10 : 5;
      const prizePool = totalPaid - houseFee;
      
      document.getElementById('currentPrizePool').textContent = prizePool;
      document.getElementById('firstPrize').textContent = Math.round(prizePool * 0.8);
      document.getElementById('secondPrize').textContent = Math.round(prizePool * 0.2);
    }

    function startTournament() {
      if (players.length < 2) {
        alert('Need at least 2 players to start');
        return;
      }
      
      tournamentStarted = true;
      document.getElementById('startBtn').disabled = true;
      document.getElementById('rebuyBtn').disabled = false;
      document.getElementById('prizeBtn').disabled = false;
      
      updatePlayerTable();
      updateRoundDisplay();
    }

    function processRebuys() {
      // This is just a placeholder - individual rebuys are handled per player
      alert('Use individual Re-buy buttons for each eliminated player');
    }

    function processAddons() {
      if (!isBreak) {
        alert('Add-ons only available during break');
        return;
      }
      alert('Use individual Add-on buttons for each player');
    }

    function calculatePrizes() {
      const activePlayers = players.filter(p => !p.eliminated);
      if (activePlayers.length > 2) {
        alert('Tournament not finished yet - need exactly 2 players remaining');
        return;
      }
      
      const totalPaid = players.reduce((sum, p) => sum + p.totalPaid, 0);
      const houseFee = totalPaid > 100 ? 10 : 5;
      const prizePool = totalPaid - houseFee;
      
      let results = '';
      if (activePlayers.length === 1) {
        results = `
          <div class="prize-info">
            <h3>Tournament Results</h3>
            <p><strong>Winner: ${activePlayers[0].name}</strong> - ¬£${Math.round(prizePool * 0.8)}</p>
            <p><strong>Runner-up:</strong> - ¬£${Math.round(prizePool * 0.2)}</p>
            <p>Total Prize Pool: ¬£${prizePool}</p>
            <p>House Fee: ¬£${houseFee}</p>
          </div>
        `;
      } else if (activePlayers.length === 2) {
        results = `
          <div class="prize-info">
            <h3>Final Two Players</h3>
            <p><strong>${activePlayers[0].name}</strong> vs <strong>${activePlayers[1].name}</strong></p>
            <p>Winner gets: ¬£${Math.round(prizePool * 0.8)}</p>
            <p>Runner-up gets: ¬£${Math.round(prizePool * 0.2)}</p>
            <button onclick="declareWinner('${activePlayers[0].name}')">Declare ${activePlayers[0].name} Winner</button>
            <button onclick="declareWinner('${activePlayers[1].name}')">Declare ${activePlayers[1].name} Winner</button>
          </div>
        `;
      }
      
      document.getElementById('prizeResults').innerHTML = results;
    }

    function declareWinner(winnerName) {
      const totalPaid = players.reduce((sum, p) => sum + p.totalPaid, 0);
      const houseFee = totalPaid > 100 ? 10 : 5;
      const prizePool = totalPaid - houseFee;
      
      const activePlayers = players.filter(p => !p.eliminated);
      const runnerUp = activePlayers.find(p => p.name !== winnerName);
      
      document.getElementById('prizeResults').innerHTML = `
        <div class="prize-info">
          <h3>üèÜ Tournament Complete! üèÜ</h3>
          <p><strong>Winner: ${winnerName}</strong> - ¬£${Math.round(prizePool * 0.8)}</p>
          <p><strong>Runner-up: ${runnerUp ? runnerUp.name : 'Unknown'}</strong> - ¬£${Math.round(prizePool * 0.2)}</p>
          <p>Total Prize Pool: ¬£${prizePool}</p>
          <p>House Fee: ¬£${houseFee}</p>
        </div>
      `;
    }

    // Timer functions
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function updateRoundDisplay() {
      const round = rounds[currentRound];
      const roundInfo = document.getElementById('roundInfo');
      
      if (round.isBreak) {
        roundInfo.innerHTML = `
          <div>${round.name}</div>
          <div class="blind-display">30 Minutes Break</div>
          <div style="font-size: 1.2rem;">Add-ons Available</div>
        `;
        document.getElementById('breakNotice').style.display = 'block';
        document.getElementById('addonBtn').disabled = false;
        isBreak = true;
      } else {
        roundInfo.innerHTML = `
          <div>${round.name}</div>
          <div class="blind-display">SB: ${round.sb} | BB: ${round.bb}</div>
          <div style="font-size: 1.2rem;">Duration: ${round.duration} minutes</div>
        `;
        document.getElementById('breakNotice').style.display = 'none';
        isBreak = false;
        
        if (currentRound >= 5) { // After break
          document.getElementById('finalStage').style.display = 'block';
          document.getElementById('addonBtn').disabled = true;
          isFinalStage = true;
          // Disable rebuys for all players
          players.forEach(p => p.canRebuy = false);
          updatePlayerTable();
        }
      }
      
      timeLeft = round.duration * 60;
      document.getElementById('timeRemaining').textContent = formatTime(timeLeft);
    }

    function startTimer() {
      if (!tournamentStarted) {
        alert('Please start the tournament first');
        return;
      }
      
      isRunning = true;
      isPaused = false;
      document.getElementById('timerStartBtn').disabled = true;
      document.getElementById('timerPauseBtn').disabled = false;
      
      timer = setInterval(() => {
        if (!isPaused) {
          timeLeft--;
          document.getElementById('timeRemaining').textContent = formatTime(timeLeft);
          
          if (timeLeft <= 0) {
            nextRound();
          }
        }
      }, 1000);
    }

    function pauseTimer() {
      isPaused = !isPaused;
      document.getElementById('timerPauseBtn').textContent = isPaused ? 'RESUME' : 'PAUSE';
    }

    function resetTimer() {
      clearInterval(timer);
      isRunning = false;
      isPaused = false;
      document.getElementById('timerStartBtn').disabled = false;
      document.getElementById('timerPauseBtn').disabled = true;
      document.getElementById('timerPauseBtn').textContent = 'PAUSE';
      updateRoundDisplay();
    }

    function skipRound() {
      nextRound();
    }

    function nextRound() {
      // Play alarm sound
      document.getElementById('roundAlarm').play().catch(() => {});
      
      // Flash the timer
      document.getElementById('timeRemaining').classList.add('flash');
      setTimeout(() => {
        document.getElementById('timeRemaining').classList.remove('flash');
      }, 3000);
      
      if (currentRound < rounds.length - 1) {
        currentRound++;
        updateRoundDisplay();
        
        if (isRunning) {
          // Auto-start next round
          timeLeft = rounds[currentRound].duration * 60;
          document.getElementById('timeRemaining').textContent = formatTime(timeLeft);
        }
      } else {
        // Tournament time complete
        clearInterval(timer);
        isRunning = false;
        document.getElementById('timerStartBtn').disabled = false;
        document.getElementById('timerPauseBtn').disabled = true;
        alert('All rounds complete! Finish the tournament.');
      }
    }

    // Initialize
    updatePlayerTable();
    updatePrizeInfo();
    updateRoundDisplay();
  </script>
</body>
</html>
